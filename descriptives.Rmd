---
title: "Initial Descriptives"
author: "Group 3: Institutional Characteristics"
date: "`r Sys.Date()`"
output: 
  prettydoc::html_pretty:
    theme: cayman
    toc: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(here, rio, tidyverse, janitor)
```

## Introduction

We are creating descriptives for the data here.

Research Question:

### Creating one dataset

```{r individual data files}
finance_data <- import(here("Data", "Data Institutional Finance Variables.csv"))  %>% # Dong
  janitor::clean_names()

dependentdv_data <- import(here("Data", "Data Dependent Variables.csv")) %>% # Dong
  janitor::clean_names()

studentbody_data <- import(here("Data", "Data Student Body Composition Variables.csv")) %>%  # Anwesha
  janitor::clean_names()

carnegie_data <- import(here("Data/Data Carnegie Variables", "Data Carnegie Variables.csv")) %>% # Anwesha
  janitor::clean_names()

academic_data <- import(here("Data", "Data Academic Variables.csv")) %>% # Amleset
  janitor::clean_names()

admissions_data <- import(here("Data", "Data Admissions Variables.csv")) %>% # Amleset
  janitor::clean_names()

geographic_data <- import(here("Data/Data Geographic Variables", "Data Geographic Variables.csv")) %>% # Kurt
  janitor::clean_names()

# non-IPEDS data TBD # Kurt
```


```{r}
# aimed format: institution, year, variable, value

#starting off with finance data
finance_data <- finance_data %>%
  select(1:2, sort(names(.)[-(1:2)]), -v218) #sort alphabetical to better see vars. also, v218 is an empty variable tacked onto the end, so I removed it here

# most follow the 4-digit year format, except the avg net price i'll remove those, clean them up, and then add them back in.
finance_netprice_clean <- finance_data %>%
  select(unit_id, institution_name, starts_with("average_net_price")) %>% 
  mutate(avg_net_price_w_aid_2019 = coalesce(average_net_price_students_awarded_grant_or_scholarship_aid_2018_19_sfa1819_rv,
                                             average_net_price_students_awarded_grant_or_scholarship_aid_2018_19_sfa1819_rv_2),
         avg_net_price_w_aid_2020 = coalesce(average_net_price_students_awarded_grant_or_scholarship_aid_2019_20_sfa1920_rv,
                                             average_net_price_students_awarded_grant_or_scholarship_aid_2019_20_sfa1920_rv_2),
         avg_net_price_w_aid_2021 = coalesce(average_net_price_students_awarded_grant_or_scholarship_aid_2020_21_sfa2021_rv,
                                             average_net_price_students_awarded_grant_or_scholarship_aid_2020_21_sfa2021_rv_2),
         avg_net_price_w_aid_2022 = coalesce(average_net_price_students_awarded_grant_or_scholarship_aid_2021_22_sfa2122_rv,
                                             average_net_price_students_awarded_grant_or_scholarship_aid_2021_22_sfa2122_rv_2),
         avg_net_price_w_aid_2023 = coalesce(average_net_price_students_awarded_grant_or_scholarship_aid_2022_23_sfa2223,
                                             average_net_price_students_awarded_grant_or_scholarship_aid_2022_23_sfa2223_2)) %>% 
  select(1, 2, 13:17)

finance_data <- finance_data %>% 
  select(-starts_with("average_net_price"), -starts_with("imputation")) %>%  #removing imputation flag for now
  left_join(., finance_netprice_clean) 

finance_data_clean <- finance_data %>% 
  pivot_longer(
    cols = -c(unit_id, institution_name),
    names_to = "variable",
    values_to = "value"
  ) %>% 
  mutate(
    year = str_extract(variable, "\\d{4}")
  )
## values don't quite look right -- double check this!
```



### Dependent Variables

Info.

### Independent Variables

Info.

## Exploratory Questions

### Overall Trends

Guiding Questions:

- What is the percent of [institutions] that have seen an increase in undergraduate enrollment [in recent history]? What is the percent of [institutions] that have seen a decrease in undergraduate enrollment [in recent history]? 
- What percent of [institutions] have seen an increase in undergraduate enrollment [in recent history] of [scale, e.g., 10% or more]? What is the percent of [institutions] that have seen a decrease in undergraduate enrollment [in recent history] of [scale, e.g., 10% or more]? 

### Changing Enrollment

Guiding Questions:

- Is change in undergraduate enrollment [in recent history] correlated with change in application volume (number of applicants)? At what scale? [Same year] 
- Is change in undergraduate enrollment [in recent history] correlated with change in yield rate (% of admitted students who enroll at the institution)? At what scale? 
- Is change in undergraduate enrollment [in recent history] correlated with change in “attractor score” (number of applicants * yield rate)? At what scale? 
- Is change in undergraduate enrollment [in recent history] correlated with change in new student enrollment (first-time, first-year and transfer students, together and/or separately)? 

### Student Composition

Which student populations are increasing/decreasing in enrollment? 
- Enrollment by race/ethnicity 
- Percent Pell 
- Adult age (25-64) enrollment 

### Intersection between Enrollment and Graduation

TBD.

